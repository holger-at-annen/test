<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Final Layout with Updated Functionality</title>
  <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.22.9/babel.min.js"></script>
  <link href="/styles.css" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100vh;
      box-sizing: border-box;
      overflow: hidden;
    }
    body {
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #root {
      display: flex;
      flex-direction: row;
      gap: 8px;
      max-width: 896px;
      min-width: 908px;
      height: 100vh;
      padding: 1rem;
      box-sizing: border-box;
      align-items: stretch;
    }
    .contact-form {
      background: white;
      width: 500px;
      max-height: 100%;
      padding: 1rem;
      border: 1px solid #ccc;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    .contact-list {
      background: white;
      width: 400px;
      max-height: 100%;
      padding: 1rem;
      border: 1px solid #ccc;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    .contact-form h1, .contact-list h1 {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    .contact-form h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 1rem 0 0.5rem;
    }
    .form-scrollable {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      min-height: 100px;
    }
    .list-scrollable {
      flex: 1;
      overflow-y: auto;
      min-height: 100px;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 0.25rem;
    }
    .form-group input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 0.25rem;
      box-sizing: border-box;
    }
    .error-message {
      color: #ef4444;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
    .contact-list ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    .contact-list li {
      display: flex;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #eee;
    }
    .contact-list li:last-child {
      border-bottom: none;
    }
    .contact-list li input[type="checkbox"] {
      margin: 0 0.5rem 0 0;
      width: 16px;
      height: 16px;
    }
    .contact-list li span {
      flex-grow: 1;
    }
    .edit-icon-container {
      width: 16px;
      height: 16px;
      margin-left: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .edit-icon {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }
    .btn-primary {
      background: #3b82f6;
      color: white;
      padding: 0.5rem 1.5rem;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
    }
    .btn-primary:hover {
      background: #2563eb;
    }
    .btn-primary:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .btn-secondary {
      background: #22c55e;
      color: white;
      padding: 0.5rem 1.5rem;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
    }
    .btn-secondary:hover {
      background: #16a34a;
    }
    .btn-secondary:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .btn-full {
      width: 100%;
      box-sizing: border-box;
    }
    .button-row {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    try {
      const { createRoot } = ReactDOM;
      function InteractiveLayout() {
        const initialFormData = {
          givenname: '',
          sn: '',
          displayname: '',
          title: '',
          position: '',
          department: '',
          email: '',
          telephonenumber: '',
          mobile: '',
          street: '',
          postalcode: '',
          city: '',
          state: '',
          country: ''
        };
        const [formData, setFormData] = React.useState(initialFormData);
        const [contacts, setContacts] = React.useState([]);
        const [selectedContacts, setSelectedContacts] = React.useState([]);
        const [editingContactId, setEditingContactId] = React.useState(null);
        const [errorMessage, setErrorMessage] = React.useState('');

        React.useEffect(() => {
          console.log('Viewport width:', window.innerWidth);
          console.log('Viewport height:', window.innerHeight);
          const rootDiv = document.getElementById('root');
          if (rootDiv) {
            const rect = rootDiv.getBoundingClientRect();
            console.log('Root container left:', rect.left);
            console.log('Root container right:', rect.right);
            console.log('Root container width:', rect.width);
            console.log('Root container height:', rect.height);
            console.log('Root container computed style:', getComputedStyle(rootDiv));
            console.log('Centering check:', {
              expectedLeft: (window.innerWidth - rect.width) / 2,
              actualLeft: rect.left,
              expectedTop: (window.innerHeight - rect.height) / 2,
              actualTop: rect.top
            });
          }
          const contactFormDiv = document.querySelector('.contact-form');
          const contactListDiv = document.querySelector('.contact-list');
          if (contactFormDiv && contactListDiv) {
            console.log('Root children layout:', {
              contactFormLeft: contactFormDiv.getBoundingClientRect().left,
              contactListLeft: contactListDiv.getBoundingClientRect().left,
              sideBySide: contactListDiv.getBoundingClientRect().left > contactFormDiv.getBoundingClientRect().left,
              contactFormHeight: contactFormDiv.getBoundingClientRect().height,
              contactListHeight: contactListDiv.getBoundingClientRect().height
            });
          }
        }, [contacts]);

        const handleChange = (e) => {
          const { name, value } = e.target;
          setFormData({ ...formData, [name]: value });
          if (name === 'displayname' && errorMessage) {
            setErrorMessage('');
          }
        };

        const handleClearForm = () => {
          setFormData(initialFormData);
          setEditingContactId(null);
          setErrorMessage('');
        };

        const handleAddToList = () => {
          if (!formData.displayname) {
            setErrorMessage('Anzeigename ist erforderlich.');
            return;
          }
          if (editingContactId) {
            setContacts(contacts.map(contact =>
              contact.id === editingContactId ? { ...formData, id: editingContactId } : contact
            ));
            setEditingContactId(null);
          } else {
            const newContact = { ...formData, id: Date.now() };
            setContacts([...contacts, newContact]);
          }
          setFormData(initialFormData);
          setErrorMessage('');
        };

        const handleAddToListWithoutClear = () => {
          if (!formData.displayname) {
            setErrorMessage('Anzeigename ist erforderlich.');
            return;
          }
          if (editingContactId) {
            setContacts(contacts.map(contact =>
              contact.id === editingContactId ? { ...formData, id: editingContactId } : contact
            ));
            setEditingContactId(null);
          } else {
            const newContact = { ...formData, id: Date.now() };
            setContacts([...contacts, newContact]);
          }
          setErrorMessage('');
        };

        const handleEditContact = (contact) => {
          setFormData(contact);
          setEditingContactId(contact.id);
          setErrorMessage('');
        };

        const handleSelectContact = (contactId) => {
          setSelectedContacts(prev =>
            prev.includes(contactId)
              ? prev.filter(id => id !== contactId)
              : [...prev, contactId]
          );
        };

        const handleSelectAll = () => {
          if (selectedContacts.length === contacts.length) {
            setSelectedContacts([]);
          } else {
            setSelectedContacts(contacts.map(contact => contact.id));
          }
        };

        const handleDeleteSelected = () => {
          setContacts(contacts.filter(contact => !selectedContacts.includes(contact.id)));
          setSelectedContacts([]);
        };

        const handleSend = () => {
          const receiverEmail = 'receiver@example.com'; // Placeholder for process.env.RECEIVER_EMAIL
          const subject = encodeURIComponent('Kontakte');
          const body = contacts.map(contact => {
            return [
              `Vorname: ${contact.givenname || ''}`,
              `Nachname: ${contact.sn || ''}`,
              `Anzeigename: ${contact.displayname || ''}`,
              `Titel: ${contact.title || ''}`,
              `Position: ${contact.position || ''}`,
              `Abteilung: ${contact.department || ''}`,
              `E-Mail: ${contact.email || ''}`,
              `Telefonnummer: ${contact.telephonenumber || ''}`,
              `Handynummer: ${contact.mobile || ''}`,
              `Stra√üe: ${contact.street || ''}`,
              `PLZ: ${contact.postalcode || ''}`,
              `Ort: ${contact.city || ''}`,
              `Bundesland: ${contact.state || ''}`,
              `Land: ${contact.country || ''}`,
              '---'
            ].join('\n');
          }).join('\n\n');
          const encodedBody = encodeURIComponent(body);
          const mailtoLink = `mailto:${receiverEmail}?subject=${subject}&body=${encodedBody}`;
          window.location.href = mailtoLink;
          console.log('Opening mailto link:', mailtoLink);
        };

        const renderInput = (label, name, value) => (
          <div className="form-group">
            <label>{label}</label>
            <input
              type="text"
              name={name}
              value={value}
              onChange={handleChange}
              className="w-full px-3 py-2 border rounded-lg"
            />
            {name === 'displayname' && errorMessage && (
              <div className="error-message">{errorMessage}</div>
            )}
          </div>
        );

        return (
          <>
            <div className="contact-form">
              <div className="mb-4">
                <h1>Kontakt:</h1>
                <div style={{ marginTop: '0.5rem' }}>
                  <button onClick={handleClearForm} className="btn-secondary btn-full">
                    Neu
                  </button>
                </div>
              </div>
              <div className="form-scrollable">
                <h2>Bezeichnung:</h2>
                {renderInput('Vorname:', 'givenname', formData.givenname)}
                {renderInput('Nachname:', 'sn', formData.sn)}
                {renderInput('Anzeigename:', 'displayname', formData.displayname)}
                <h2>Informationen:</h2>
                {renderInput('Titel:', 'title', formData.title)}
                {renderInput('Position:', 'position', formData.position)}
                {renderInput('Abteilung:', 'department', formData.department)}
                <h2>Kontaktm√∂glichkeiten:</h2>
                {renderInput('E-Mail:', 'email', formData.email)}
                {renderInput('Telefonnummer:', 'telephonenumber', formData.telephonenumber)}
                {renderInput('Handynummer:', 'mobile', formData.mobile)}
                <h2>Adresse:</h2>
                {renderInput('Stra√üe:', 'street', formData.street)}
                {renderInput('PLZ:', 'postalcode', formData.postalcode)}
                {renderInput('Ort:', 'city', formData.city)}
                {renderInput('Bundesland:', 'state', formData.state)}
                {renderInput('Land:', 'country', formData.country)}
              </div>
              <div className="mt-4 flex flex-col gap-2">
                <button onClick={handleAddToListWithoutClear} className="btn-primary btn-full">
                  Zur Liste hinzuf√ºgen ohne l√∂schen
                </button>
                <button onClick={handleAddToList} className="btn-primary btn-full">
                  {editingContactId ? '√Ñnderung speichern' : 'Zur Liste hinzuf√ºgen'}
                </button>
              </div>
            </div>
            <div className="contact-list">
              <div className="mb-4">
                <h1>Liste von Kontakten</h1>
                <div className="button-row" style={{ marginTop: '0.5rem' }}>
                  <button
                    onClick={handleSelectAll}
                    className="btn-secondary"
                    disabled={contacts.length === 0}
                  >
                    {selectedContacts.length === contacts.length && contacts.length > 0 ? 'Alle abw√§hlen' : 'Alle ausw√§hlen'}
                  </button>
                  <button
                    onClick={handleDeleteSelected}
                    className="btn-primary"
                    disabled={selectedContacts.length === 0}
                  >
                    Auswahl l√∂schen
                  </button>
                </div>
              </div>
              <div className="list-scrollable">
                <ul>
                  {contacts.map(contact => (
                    <li key={contact.id}>
                      <input
                        type="checkbox"
                        checked={selectedContacts.includes(contact.id)}
                        onChange={() => handleSelectContact(contact.id)}
                      />
                      <span>{contact.displayname}</span>
                      <div className="edit-icon-container">
                        <svg
                          className="edit-icon"
                          onClick={() => handleEditContact(contact)}
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            strokeLinecap="round"
                            strokeLinejoin="round"
                            strokeWidth="1.5"
                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15.414 9 16l.586-2.828L17.414 5.586z"
                          />
                        </svg>
                      </div>
                    </li>
                  ))}
                </ul>
              </div>
              <button
                onClick={handleSend}
                className="mt-4 btn-secondary btn-full"
                disabled={contacts.length === 0}
              >
                Senden
              </button>
            </div>
          </>
        );
      }

      const root = createRoot(document.getElementById('root'));
      root.render(<InteractiveLayout />);
    } catch (e) {
      console.error('Script error details:', e);
      document.body.innerHTML = '<h1>Error loading application. Check console for details.</h1>';
    }
  </script>
</body>
</html>
